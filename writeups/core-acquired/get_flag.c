#include <stdio.h>
#include <stdbool.h>
char xor_base[] = {0xd7,0x77,0xf5,0x85,0x86,0xca,0x38,0x39,0xb6,0x44,0x66,0x95,0x76,0xe8,0xa9,0x8c,0x98,0xa8,0x60,0x6e,0x83,0xa1,0x72,0xd,0xc6,0x1a,0x7f,0xa7,0xe5,0x54,0x6f,0x79,0xbb,0xa4,0x12,0xef,0xa5,0x2,0xe3,0x50,0x7d,0x68,0xee,0xf6,0xc5,0xc0,0x24,0x9c,0x4a,0x5d,0x43,0x19,0xdd,0x9d,0xf0,0x57,0xb8,0x46,0xaa,0x51,0x34,0x40,0xbe,0x5c,0xba,0xae,0xf7,0x3d,0x9e,0x13,0xb9,0xbf,0xa3,0xb,0x8e,0x65,0x36,0xed,0xc2,0x90,0x63,0x35,0xab,0x81,0x7a,0x9a,0x45,0x27,0xf3,0xb3,0xe6,0x97,0xe2,0x0,0x2e,0xd1,0x30,0x3f,0x1f,0x56,0xbc,0xe1,0xd3,0x8,0x52,0x5e,0x17,0xc7,0xf8,0x22,0xb0,0xcb,0x6,0x7e,0x93,0x47,0x4,0x82,0xa2,0x62,0x29,0x6a,0xe4,0x94,0xf,0x9f,0x20,0x59};
unsigned char ** dec_tbl; 
unsigned int * dec_counts;
//dec_tbl [c] represents all characters that when provided as input to the original program in the core dump, could result in encoded character c.
//dec_counts[c] is the amount of characters that could result in encoded character c.

//Our encoded flag
unsigned char enc[] = {0x42,0xd2,0x2e,0xd2,0xef,0x7e,0xdf,0xf9,0x56,0x8e,0xda,0xcf,0xa0,0x33,0xa8,0x8e,0xef,0xf9,0x56,0x8e,0xeb,0x56,0x7a,0x33,0xff,0xcf,0x6c,0x6c,0xe2,0x6c};

bool check_char(unsigned char c){
	if(c > 128){
		return false;
	}
	if(c >= '0' && c <= '9'){
		return true;
	}
	if(c == '_' || c == '{' || c == '}'){
		return true;
	}
	if(c >='A' && c <= 'Z'){
		return true;
	}
	return false;
}
void create_map(){
	for (unsigned char i = 0x10; i < 128; i++){
		unsigned char val =  (unsigned char)( i ^ xor_base[i]);
		dec_tbl[val][dec_counts[val]++] = i;
	}
}

void init_decode(){
	dec_tbl = malloc(256 * sizeof(char *));
	dec_counts = malloc(256 * sizeof(int));

	for(int i = 0; i < 256; i++){
		dec_tbl[i] = malloc(0x10);
		dec_counts[i] = 0;
	}
}

void decode(){
	for(int i = 0; i < sizeof(enc); i++){
		for(int j = 0; j < dec_tbl[enc[i]][dec_counts[0]]; j++){
			unsigned char decoded = dec_tbl[enc[i]][j];
			if(check_char(decoded)){	
				printf("%c",  decoded); 
			}
		}
		puts("");
	}
}

int main(){
	init_decode();
	create_map();
	decode();
}